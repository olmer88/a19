<h1><%= list.name %></h1>
<div class="wrap">
<form method="post">
  <label>
    Task:
    <input type="text" placeholder="write your task here" required name="task">
    <input type="hidden" name="listId" value="<%= list.listId %>">
  </label>
  <input type="submit" value="Add">
</form>
<ol style="display: flex;flex-direction: column">
  <% tasks.forEach(task => { %>
  <li style="display: flex;">
    <form action="/check-task" method="post" style="display: flex">
      <input value="<%= task.taskId  %>" name="taskId" type="hidden">
      <input name="checked" value="true" type="checkbox" <%= task.doneAt ? 'checked' : '' %>
      onChange="this.form.submit()" >
    </form>
    <span class="check" style="<%= task.doneAt ? 'text-decoration: brown line-through' : '' %>">
      <%=task.description %>
    </span>
    <% if(!task.doneAt) {%>
    <form action="/moveUp" method="post">
      <input type="hidden" name="targetId" value="<%= task.taskId %>">
      <input type="hidden" name="listId" value="<%= list.listId %>">
      <input type="submit" value="up">
    </form>
    <% }%>
    <form action="/delete-task" method="post" style="display: flex">
      <input value="<%= task.taskId  %>" name="taskId" type="hidden">
      <input value="<%= list.listId  %>" name="listId" type="hidden">
      <input type="submit" value="x">
    </form>
    <span style="font-size: 10px; color: red; margin-left: 10px">
<%
      const createdAt = new Date(task.createdAt);
      const now = new Date();
      let formatPattern = 'hh:mm';
      if(
      createdAt.getFullYear() !== now.getFullYear() ||
      createdAt.getMonth() !== now.getMonth() ||
      createdAt.getDate() !== now.getDate()
      ){
       formatPattern += ' MM-DD-YYYY';
      }
      %>
      <%= moment(task.createdAt).format(formatPattern) %>
    </span>
      <% if(task.doneAt) { %>
    <span style="font-size: 10px; color: green; margin-left: 10px">
        <%= moment(task.doneAt).format(formatPattern) %>
    </span>
      <% } %>
  </li>
  <% }); %>
</ol>
</div>

<script>
    /*
     function checkBox(id,ctx,listId) {
         return new Promise(((resolve, reject) => {
             let xhr = new XMLHttpRequest();
             xhr.open('POST','/checked',true);
             xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
             xhr.send(`taskId=${id}&checked=${ctx.checked}&listId=${listId}`);
             resolve('ok');
         })).then((res)=>console.log(res));

         /*
        let xhr = new XMLHttpRequest();
        xhr.open('POST','/checked',true);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.send(`taskId=${id}&checked=${ctx.checked}&listId=${listId}`);*/
        //xhr.send(`taskId=${id}&checked=${ctx.checked}&listId=${listId}`);
        //setTimeout(() => console.log(xhr.response),1000);

   // }
    //checkBox(id,ctx,listId).then(console.log);

</script>
